import subprocess

def check_sql_injection(url):
    # Configuration de la commande SQLmap
    command = ['sqlmap', '-u', url, '--batch', '--flush-session', '--level=5', '--risk=3']

    # Exécuter SQLmap comme sous-processus
    try:
        result = subprocess.run(command, capture_output=True, text=True, timeout=300)
        output = result.stdout
        
        # Rechercher des preuves d'injection SQL réussie
        if "all tested parameters appear to be not injectable" in output:
            print("No SQL Injection vulnerabilities found.")
        elif "GET parameter" in output and "is vulnerable" in output:
            print("SQL Injection vulnerability found!")
        else:
            print("SQL Injection status is unclear. Manual review recommended.")
        
        # Pour un débogage, décommentez la ligne suivante pour voir la sortie complète
        # print(output)

    except subprocess.TimeoutExpired:
        print("SQLmap did not finish within the timeout period.")

# Exemple d'utilisation
if __name__ == '__main__':
    test_url = "http://192.168.1.161/payroll_app.php"  # Assurez-vous d'inclure un paramètre testable
    check_sql_injection(test_url)